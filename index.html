<!DOCTYPE html>
<html>
<head>
    <title>LiveLoc Kantor - Info Lengkap</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { height: 100vh; width: 100vw; }

        /* Zoom Control */
        .zoom-controls {
            position: absolute; bottom: 100px; right: 20px;
            z-index: 1000; display: flex; flex-direction: column; gap: 10px;
        }
        .zoom-btn {
            width: 50px; height: 50px;
            background: white; border: none; border-radius: 50%;
            font-size: 24px; font-weight: bold; color: #333;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .zoom-btn:active { background: #f0f0f0; }

        /* Tombol Lokasi */
        .btn-loc {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 1000; background: #007bff; color: white; border: none;
            padding: 12px 25px; border-radius: 50px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer;
        }
        
        /* Info Akurasi */
        .info-box {
            position: absolute; top: 10px; right: 10px; z-index: 1000;
            background: white; padding: 8px 15px; border-radius: 8px;
            font-size: 13px; border: 1px solid #ccc; font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        /* Label Ruangan */
        .label-ruang {
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid #333; color: #000;
            padding: 2px 6px; border-radius: 4px;
            font-size: 11px; font-weight: bold; 
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            cursor: pointer; /* Menunjukkan bisa diklik */
        }
    </style>
</head>
<body>

    <div id="map"></div>
    <div class="info-box" id="info-gps">Menunggu GPS...</div>

    <div class="zoom-controls">
        <button class="zoom-btn" onclick="map.zoomIn()">+</button>
        <button class="zoom-btn" onclick="map.zoomOut()">‚àí</button>
    </div>

    <button class="btn-loc" onclick="lacakSaya()">üìç Posisi Saya</button>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- 1. SETUP PETA ---
        var pojokKiriAtas = [-7.815907, 110.293634]; 
        var pojokKananBawah = [-7.817137, 110.295956]; 
        var bounds = [pojokKiriAtas, pojokKananBawah];
        
        var map = L.map('map', {zoomControl: false}).fitBounds(bounds);

        L.tileLayer('http://{s}.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
            maxZoom: 21, subdomains: ['mt0', 'mt1', 'mt2', 'mt3'], attribution: '¬© Google Maps'
        }).addTo(map);

        L.imageOverlay('denah.png', bounds, { opacity: 0.8 }).addTo(map);

        // --- 2. DATA RUANGAN (DENGAN INFO & FOTO) ---
        // Cara Pakai:
        // foto: 'nama_file_foto.jpg' (Harus diupload ke GitHub dulu)
        // info: Tulisan keterangan (bisa pakai <br> untuk baris baru)
        
        var ruangan = [
            { 
                nama: "R. Security", 
                lat: -7.816434, 
                lng: 110.29455,
                foto: "security.png", // Ganti dengan nama file foto Anda nanti
                info: "Pos Penjagaan 24 Jam.<br><b>Lapor tamu disini.</b>"
            },
            { 
                nama: "Taman Alat", 
                lat: -7.81659, 
                lng: 110.29485,
                foto: "tamanalat.jpeg", // Ganti dengan nama file foto Anda nanti
                info: "Area pengamatan meteorologi permukaan.<br><b>Dilarang Masuk Tanpa Izin.</b>"
            },
            { 
                nama: "Pantry", 
                lat:   -7.81674, 
                lng: 110.294619,
                foto: "minimuseum.jpeg", // Ganti dengan nama file foto Anda nanti
                info: "Museum peralatan observasi gempabumi.<br><b>Lobby R.PGR VII.</b>"
            },
            { 
                nama: "R.ManopTI, PIMKG dan MP", 
                lat:   -7.81677, 
                lng: 110.29469,
                foto: "", // Ganti dengan nama file foto Anda nanti
                info: "Ruang Manajemen Operasional dan Teknologi Informasi, Pengembangan Inovasi Meteorologi, Klimatologi dan Geofisika.<br><b></b>"
            },
            { 
                nama: "Toilet", 
                lat:   -7.81675, 
                lng: 110.29465,
                foto: " ", // Ganti dengan nama file foto Anda nanti
                info: "Toilet Pria dan Wanita.<br><b>Lobby R.PGR VII.</b>"
            },
            { 
                nama: "Mini Museum", 
                lat:   -7.816701, 
                lng: 110.294635,
                foto: "minimuseum.jpeg", // Ganti dengan nama file foto Anda nanti
                info: "Museum peralatan observasi gempabumi.<br><b>Lobby R.PGR VII.</b>"
            },
            { 
                nama: "Gedung Grha BMKG", 
                lat:   -7.816284, 
                lng: 110.294630,
                foto: "grha.png", // Ganti dengan nama file foto Anda nanti
                info: "Gedung Pertemuan<br><b>BMKG - Stageof Sleman</b>"
            },
            { 
                nama: "Gedung PGRVII", 
                lat:   -7.81677, 
                lng: 110.294787,
                foto: "", // Ganti dengan nama file foto Anda nanti
                info: "Ruang Operasional PGR VII<br><b>BMKG - Stageof Sleman</b>"
            },
            { 
                nama: "Mushola", 
                lat:   -7.816447, 
                lng: 110.294633,
                foto: "", // Ganti dengan nama file foto Anda nanti
                info: "Ruang Mushola<br><b>BMKG - Stageof Sleman</b>"
            },
            { 
                nama: "Toilet", 
                lat:   -7.816469, 
                lng: 110.294776,
                foto: "", // Ganti dengan nama file foto Anda nanti
                info: "Toilet Pria Wanita<br><b>BMKG - Stageof Sleman</b>"
            },
            {
                nama: "Parkir Tamu (Motor)",
                lat: -7.81646, // Sesuaikan koordinat
                lng: 110.294569, // Sesuaikan koordinat
                foto: "https://via.placeholder.com/300x200?text=Ruang+Rapat",
                info: "Parkir Tamu Kendaraan Roda Dua"
            },
            {
                nama: "R. DIM",
                lat: -7.81647, // Sesuaikan koordinat
                lng: 110.2947, // Sesuaikan koordinat
                foto: "https://via.placeholder.com/300x200?text=Ruang+Rapat",
                info: "Ruang Tim Data Informasi dan Mitigasi"
            },
            {
                nama: "Parkir Tamu (Mobil)",
                lat: -7.816564, // Sesuaikan koordinat
                lng: 110.294524, // Sesuaikan koordinat
                foto: "https://via.placeholder.com/300x200?text=Ruang+Rapat",
                info: "Parkir Tamu Kendaraan Roda Empat"
            },
            {
                nama: "Parkir Pegawai",
                lat: -7.816557, // Sesuaikan koordinat
                lng: 110.29477, // Sesuaikan koordinat
                foto: "https://via.placeholder.com/300x200?text=Ruang+Rapat",
                info: "Tempat Parkir Kendaraan Roda Dua Pegawai"
            },
            {
                nama: "R.TU",
                lat: -7.81661, // Sesuaikan koordinat
                lng: 110.294645, // Sesuaikan koordinat
                foto: "https://via.placeholder.com/300x200?text=Ruang+Rapat",
                info: "Ruang Tata Usaha dan Administrasi"
            },
            {
                nama: "R.Kepala",
                lat: -7.81663, // Sesuaikan koordinat
                lng: 110.29469, // Sesuaikan koordinat
                foto: "https://via.placeholder.com/300x200?text=Ruang+Rapat",
                info: "Ruang Kepala Stasiun Geofisika Sleman"
            },
            {
                nama: "Lobby Pelayanan",
                lat: -7.816554, // Sesuaikan koordinat
                lng: 110.294656, // Sesuaikan koordinat
                foto: "https://via.placeholder.com/300x200?text=Ruang+Rapat",
                info: "Ruang Tunggu Tamu dan Loket Pelayanan MKG"
            }
        ];

        // Loop Membuat Marker & Popup
        ruangan.forEach(function(r) {
            // Marker transparan sebagai pemicu klik
            var marker = L.marker([r.lat, r.lng], { opacity: 0 }).addTo(map);
            
            // Tampilkan Label
            marker.bindTooltip(r.nama, { permanent: true, direction: "center", className: "label-ruang", interactive: true });

            // Siapkan Isi Popup (HTML)
            var isiPopup = "<div style='text-align:center; width:200px;'>";
            
            // Jika ada foto, tampilkan
            if (r.foto) {
                isiPopup += "<img src='" + r.foto + "' style='width:100%; border-radius:5px; margin-bottom:5px;'>";
            }
            
            isiPopup += "<h3 style='margin:5px 0; color:#007bff;'>" + r.nama + "</h3>";
            
            // Jika ada info, tampilkan
            if (r.info) {
                isiPopup += "<p style='margin:0; font-size:13px; color:#333;'>" + r.info + "</p>";
            }
            
            isiPopup += "</div>";

            // Pasang Popup ke Marker
            marker.bindPopup(isiPopup);
        });

        // --- 3. GPS SETUP ---
        var userMarker = L.circleMarker([0,0], { radius: 8, color: 'white', fillColor: '#007bff', fillOpacity: 1 }).addTo(map);
        var accuracyCircle = L.circle([0,0], { radius: 1, color: '#007bff', weight: 1, fillOpacity: 0.2 }).addTo(map);
        var gpsActive = false;

        function lacakSaya() {
            if (!navigator.geolocation) return alert("Browser tidak support GPS");
            navigator.geolocation.watchPosition(
                (pos) => {
                    var lat = pos.coords.latitude;
                    var lng = pos.coords.longitude;
                    var acc = pos.coords.accuracy;
                    userMarker.setLatLng([lat, lng]);
                    accuracyCircle.setLatLng([lat, lng]).setRadius(acc);
                    
                    var textInfo = document.getElementById('info-gps');
                    textInfo.innerHTML = "Akurasi: " + Math.round(acc) + " m";
                    
                    if(acc <= 10) {
                        textInfo.style.color = "green"; textInfo.innerHTML += " (Bagus)";
                    } else if (acc > 20) {
                        textInfo.style.color = "red"; textInfo.innerHTML += " (Lemah)";
                    } else {
                        textInfo.style.color = "orange";
                    }

                    if (!gpsActive) { map.setView([lat, lng], 20); gpsActive = true; }
                },
                (err) => { alert("Pastikan GPS aktif: " + err.message); },
                { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
            );
        }
    </script>
</body>
</html>